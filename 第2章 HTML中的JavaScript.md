---
description: 'KEYWORDS: <script>元素，<script>属性，阻塞，defer/async'
cover: .gitbook/assets/javascript-736400-1.png
coverY: 0
---

# 第2章 HTML中的JavaScript

## 2.1 \<script>元素(3)

​\<script>元素使HTML具有了灵魂（一直觉得DOM是骨架，CSS是外貌，JS是灵魂）。但是一开始的\<script>元素也经历了试错和修改形成了现有的规范。

## 2.2 \<script>属性(3)

​ 使\<script>变得强大主要是通过元素的属性实现的。\<script>属性由下列八个属性。

*   async: 即异步加载外部脚本。要理解异步实际上要知道一个前提就是浏览器默认都是按先后顺序依次解析JS脚本，前一个下载并解析结束再开始下一个。

    但是如果一个脚本过大或者执行时间过久就会导致网页卡在该脚本中，就会导致别的任务也做不了。所以此时可以加上async属性开启异步加载，相当于另开一条线程来执行加载任务。

    等该脚本异步加载完成后，会立即中断HTML解析来执行这条脚本。所以该属性会使脚本的执行时刻不定。

    特别是如果有多个async元素时，更是有点捉摸不定了。

![async](https://pic3.zhimg.com/v2-74febba4b5c4b370a7a7edea01cb5cd2\_b.png)

* defer: 延迟执行脚本，即把该脚本元素延迟到页面DOM解析完成过后再执行。defer实际上也会开启异步加载：可以理解为一个加强的async属性(下载异步，执行也异步了)

![defer](https://pic3.zhimg.com/v2-e5fef119db5c0039aa3fb6674a5d3026\_b.png)

多个defer脚本会按照HTML中出现的顺序来执行，不会破坏JS脚本之间的依赖关系。

* charset：字符集，现代浏览器基本不关心这个值了。
*   crossorigin: 配置相关请求的CORS设置，默认时不使用的。

    实际上HTML有多种元素都支持该属性: img, audio, link,video等具有外部请求属性的元素都支持crossorigin属性。

    该属性具有以下可选值：

    | 关键字               | 描述                                                                |
    | ----------------- | ----------------------------------------------------------------- |
    | `anonymous`       | 对此元素的 CORS 请求将不设置凭据标志。                                            |
    | `use-credentials` | 对此元素的CORS请求将设置凭证标志；这意味着请求将提供凭据。                                   |
    | `""`              | 设置一个空的值，如 `crossorigin` 或 `crossorigin=""`，和设置 `anonymous` 的效果一样。 |

    说白话就是请求的时候是否发送跨域需要的某些凭证。

    **实际上利用\<script>标签来实现JSONP跨域已经成为了一种常见的解决同源问题的方式。**
*   integrity: 将接受的脚本和已知的脚本经过hash后用base64编码来比对是否是同一个文件。主要是防止受到被篡改的外部脚本的攻击。

    验证的方法实际上叫做**子资源完整性验证（SRI）**。
* language: 脚本语言。已被废弃
* src: 外部脚本的路径。使用了src属性的脚本内部的代码会被忽略。该属性实际上是发送了一个HTTP GET请求。
* type：表示请求的脚本的MIME类型。

## 2.3 阻塞(3)

​ 为什么我们普遍要把脚本元素放在body的末端？

​ 首先脚本元素应该是基于DOM才有意义，如果DOM还没有被解析完成，那么脚本很有可能找不到要操作的对象。

​ 其次脚本的存在会阻塞DOM的解析，如果一个特别费时的脚本操作嵌入在了body元素的中间，那么网页就会卡在脚本的执行过程中很久，对于用户体验是毁灭性的。

​ **如果你非要写在头部，那么请加上defer标签。**

## 2.4 行内和外部脚本(2)

​ 当前的最佳实践都是把脚本独立出来，不要直接在元素内部写脚本。主要原因是提高脚本的复用性，可维护性，另外现代浏览器都会缓存脚本文件。如果多个网页复用一个脚本，那么此时打开后续网页的加载速度会得到提升。

## _本章需要你掌握的问题_

1. _说出3个\<script>的属性及其作用_
2. _async和defer的区别在哪里？_
3. _说出3个防止阻塞的方法。_
4. 进阶：如何进行首屏渲染优化？
